<!doctype html>
<html>
 <head>
    <meta charset="utf-8">
 </head>
 <body>
  {% set table_width = 600 %}
  <table border="1px" width="{{table_width}}px">
    <!-- <thead>
      <tr>
        <td>Подгруппа 1</td>
        <td>Подгруппа 2</td>
      </tr>
    </thead> -->
    {% set max_count = lessons|groupby('time_start')|max_length_of_groups %}
    {% for group in lessons|groupby('time_start') %}
    {% set count = group.list|length %}
    {% set td = (table_width-50)*1.0/count %}
    <tr>
      <td width="50px">
        <p>{{group.list|map(attribute='time_start')|first}}</p>
        <p>{{group.list|map(attribute='time_end')|first}}</p>
      </td>
      {% for item in group.list|add_empty_subgroups %}
        {% if item.subgroup=='0' %}
        <td colspan="{{max_count}}" align="center">
        {% else %}
        <td align="center" width="{{td}}px">
        {% endif %}
          {% if item!=None %}
          <p>{{item.type}}</p>
          <p>{{item.subject}}</p>
          <p>{{item.audience}}</p>
          <p>{{item.teacher}}</p>
          {% if item.subgroup!='0' %}
          <p>{{item.subgroup}}</p>
          {% endif %}
          {% endif %}
        </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </table>
 </body>
</html>